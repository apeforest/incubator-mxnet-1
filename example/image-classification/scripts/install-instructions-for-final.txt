Instructions for NVIDIA folks using Horovod-MXNet prototype:

Environment:
1) Ubuntu 16.04
2) NVCC (we tried with both CUDA 9.0 and 9.2)
3) CUDA Driver (we tried with both 384.111 and 396.37)
4) GCC 5.4.0

Additional dependencies required compared to vanilla MXNet:
1) MPI (we tested using OpenMPI 3.1.1 compiled with non-CUDA-aware)
  -we have not tested CUDA-aware MPI versions
2) NCCL (we tested with both NCCL 2.1 and 2.2)

Building:
1) git clone --recursive https://github.com/ctcyang/incubator-mxnet-1.git -b horovod_feature
   Verify that money is on branch: horovod_feature
2) Verify that horovod is on branch: mxnet_feature_fp16
3) cd mxnet & cp make/config.mk .
4) Only config.mk + Makefile build chain works. We have not added CMakeLists support yet. Append the following to config.mk:
  USE_NCCL = 1
  USE_NCCL_PATH = [directory in which libnccl.so resides]
  USE_BLAS = openblas
5) Install dependencies: libopenblas-dev libcurl4-openssl-dev libopencv-dev
5) make -j16

Running:
You can run the synthetic benchmark by doing (tested using OpenMPI 3.1.1 on AWS p3.16xlarge instances):

Synthetic data:

mpirun -np 8 --hostfile ~/host_file --bind-to none --map-by slot -x NCCL_DEBUG=INFO -x NCCL_MIN_NRINGS=4 -x LD_LIBRARY_PATH -x PATH -x MXNET_USE_OPERATOR_TUNING=0 -mca pml ob1 -mca btl ^openib python3 mxnet_imagenet_resnet50.py --batch-size 128 --dtype float32 --data-nthreads 4 --num-epochs 90 --gpus 0 --lr 0.8 --warmup-epochs 10 --model resnet50_v1 --benchmark 1

Note the use of MXNET_USE_OPERATOR_TUNING=0 flag to disable OpenMP tuning. If this flag is not included, then starting up 8 MXNet processes will take upwards of 2 minutes. We find disabling this tuning does not affect performance.

Real data:

mpirun -np 8 --hostfile ~/host_file --bind-to none --map-by slot -x NCCL_DEBUG=INFO -x NCCL_MIN_NRINGS=4 -x LD_LIBRARY_PATH -x PATH -x MXNET_USE_OPERATOR_TUNING=0 -mca pml ob1 -mca btl ^openib python3 mxnet_imagenet_resnet50.py --batch-size 128 --dtype float32 --data-nthreads 4 --num-epochs 90 --gpus 0 --lr 0.8 --warmup-epochs 10 --model resnet50_v1 --rec-train /media/ramdisk/train-passthrough.rec --rec-train-idx /media/ramdisk/train-passthrough.idx --rec-val /media/ramdisk/val-passthrough.rec --rec-val-idx /media/ramdisk/val-passthrough.idx

Testing:
The following Horovod unit tests do not pass:
  -tests that check Horovod+MXNet throws the correct error if the user passes in NDArrays that differ in size

To run tests, we did:

mpirun -np 8 --hostfile ~/host_file --bind-to none --map-by slot -x NCCL_DEBUG=INFO -x NCCL_MIN_NRINGS=4 -x LD_LIBRARY_PATH -x PATH -x MXNET_USE_OPERATOR_TUNING=0 -mca pml ob1 -mca btl ^openib python test_mxnet.py

Common error:
OSError: /home/ubuntu/horovod/horovod/mxnet/mpi_lib.cpython-36m-x86_64-linux-gnu.so: cannot open shared object file: No such file or directory

Solution: launch from another directory

Common error:
OSError: libmxnet.so: cannot open shared object file: No such file or directory

Solution: export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/ubuntu/master/lib
